<!DOCTYPE html>
<html>
    <head>
        <title>Cena 2 - Chuva de Múons (Divisão Alta)</title>
        <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    </head>

    <body>

        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; font-family: sans-serif; color: white;">
            
            <div style="position: absolute; top: 20px; left: 20px; width: 320px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); padding: 20px; border-radius: 12px; border: 1px solid #9370DB; pointer-events: auto;">
                <h2 style="color: #9370DB; margin-top: 0;">Decaimento na Alta Atmosfera</h2>
                <p style="font-size: 14px; line-height: 1.6;">
                    Ajuste de Altitude:
                    <br><br>
                    A 2ª geração agora se divide em <b>Y=3.5</b> (aprox. metade da atmosfera visual), percorrendo um caminho maior até o solo.
                </p>
            </div>

            <div style="position: absolute; top: 20px; right: 20px; pointer-events: auto;">
                <div style="background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 5px; border: 1px solid #bcacda;">
                    <span style="margin-right: 10px; font-weight: bold;">Navegação:</span>
                    <button onclick="window.location.href='index.html'" style="background: #444; color: white; border: none; padding: 8px 15px; border-radius: 3px; cursor: pointer;">Cena 1</button>
                    <button onclick="window.location.href='cena2.html'" style="background: #deb0fc; color: rgb(0, 0, 0); border: none; padding: 8px 15px; border-radius: 3px; cursor: pointer; margin-left: 5px; font-weight: bold;">Cena 2</button>
                </div>
            </div>

        </div>

        <a-scene id="cena-principal" shadow="type: pcfsoft">
            
            <a-assets>
                <img id="mapa_sol" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Map_of_the_full_sun.jpg/1280px-Map_of_the_full_sun.jpg">
                <img id="mapa_terra" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Blue_Marble_2002.png/1280px-Blue_Marble_2002.png">
                <img id="skymap" src="https://jocoteles.github.io/Minicurso-A-Frame-VR/TychoSkymap.t4_04096x02048.jpg">
            </a-assets>

            <a-sky src="#skymap" rotation="0 -90 0"></a-sky>

            <a-entity light="type: ambient; color: #444"></a-entity>
            <a-entity light="type: directional; color: #FFF; intensity: 1.5; castShadow: true" position="-10 10 -10"></a-entity>

            <a-entity position="-20 15 -20">
                <a-sphere src="#mapa_sol" radius="5" light="type: point; intensity: 2; distance: 50" material="shader: flat"></a-sphere>
            </a-entity>

            <a-entity position="0 -4 -8" rotation="0 0 23.4">
                <a-sphere src="#mapa_terra" radius="6" shadow="receive: true"></a-sphere>
                <a-sphere radius="9" material="color: #87CEEB; opacity: 0.15; transparent: true; side: back; blending: additive"></a-sphere>
            </a-entity>

        </a-scene>

        <script>
            function criarEventoCosmico() {
                var scene = document.querySelector('#cena-principal');
                var randomX = (Math.random() * 8) - 4;
                
                var container = document.createElement('a-entity');
                container.setAttribute('position', randomX + ' 0 -8');

                // --- CONFIGURAÇÃO DE TEMPOS E ALTURAS ---
                var tempoRaio = 1500;
                
                // Ponto de divisão ALTO (Metade da atmosfera)
                var alturaSplit = 3.5; 
                var splitPosLeft = '-0.6 ' + alturaSplit + ' 0';
                var splitPosRight = '0.6 ' + alturaSplit + ' 0';

                // Recalculo dos tempos baseado na distância visual
                var tempoQuedaPai = 500;   // Curto (5 -> 3.5)
                var tempoQuedaFilho = 1200; // Longo (3.5 -> 0)
                
                var delayDivisao = tempoRaio + tempoQuedaPai; 

                // 1. O RAIO
                var raio = document.createElement('a-entity');
                raio.setAttribute('geometry', 'primitive: cylinder; radius: 0.04; height: 1.5');
                raio.setAttribute('material', 'color: #FF4500; emissive: #FF4500; emissiveIntensity: 3');
                
                raio.setAttribute('animation__descida', 'property: position; from: 0 12 0; to: 0 5 0; dur: ' + tempoRaio + '; easing: linear');
                raio.setAttribute('animation__sumir', 'property: visible; from: true; to: false; dur: 0; delay: ' + tempoRaio);

                // 2. PRIMEIRA GERAÇÃO (Pais)
                
                // Múon Pai 1
                var muonPai1 = document.createElement('a-entity');
                muonPai1.setAttribute('geometry', 'primitive: sphere; radius: 0.08');
                muonPai1.setAttribute('material', 'color: #9370DB; emissive: #9370DB; emissiveIntensity: 2');
                muonPai1.setAttribute('position', '0 5 0');
                muonPai1.setAttribute('visible', 'false');
                
                muonPai1.setAttribute('animation__vis', 'property: visible; from: false; to: true; dur: 0; delay: ' + tempoRaio);
                muonPai1.setAttribute('animation__queda', 'property: position; from: 0 5 0; to: ' + splitPosLeft + '; dur: ' + tempoQuedaPai + '; delay: ' + tempoRaio + '; easing: linear');
                muonPai1.setAttribute('animation__sumir', 'property: visible; to: false; dur: 0; delay: ' + delayDivisao);

                // Múon Pai 2
                var muonPai2 = document.createElement('a-entity');
                muonPai2.setAttribute('geometry', 'primitive: sphere; radius: 0.08');
                muonPai2.setAttribute('material', 'color: #9370DB; emissive: #9370DB; emissiveIntensity: 2');
                muonPai2.setAttribute('position', '0 5 0');
                muonPai2.setAttribute('visible', 'false');

                muonPai2.setAttribute('animation__vis', 'property: visible; from: false; to: true; dur: 0; delay: ' + tempoRaio);
                muonPai2.setAttribute('animation__queda', 'property: position; from: 0 5 0; to: ' + splitPosRight + '; dur: ' + tempoQuedaPai + '; delay: ' + tempoRaio + '; easing: linear');
                muonPai2.setAttribute('animation__sumir', 'property: visible; to: false; dur: 0; delay: ' + delayDivisao);

                // 3. SEGUNDA GERAÇÃO (Filhos)
                var corEscura = "color: #FFB6C1; emissive: #FFB6C1; emissiveIntensity: 1.5";

                function criarFilhote(startPos, endX) {
                    var m = document.createElement('a-entity');
                    m.setAttribute('geometry', 'primitive: sphere; radius: 0.05');
                    m.setAttribute('material', corEscura);
                    m.setAttribute('position', startPos);
                    m.setAttribute('visible', 'false');

                    m.setAttribute('animation__vis', 'property: visible; to: true; dur: 0; delay: ' + delayDivisao);
                    m.setAttribute('animation__queda', 'property: position; to: ' + endX + ' 0.5 0; dur: ' + tempoQuedaFilho + '; delay: ' + delayDivisao + '; easing: linear');
                    
                    var tempoFinal = delayDivisao + tempoQuedaFilho;
                    m.setAttribute('animation__fim', 'property: scale; to: 0 0 0; dur: 200; delay: ' + tempoFinal);
                    return m;
                }

                var filho1a = criarFilhote(splitPosLeft, -1.8);
                var filho1b = criarFilhote(splitPosLeft, -0.4);
                var filho2a = criarFilhote(splitPosRight, 0.4);
                var filho2b = criarFilhote(splitPosRight, 1.8);

                container.appendChild(raio);
                container.appendChild(muonPai1);
                container.appendChild(muonPai2);
                container.appendChild(filho1a);
                container.appendChild(filho1b);
                container.appendChild(filho2a);
                container.appendChild(filho2b);

                scene.appendChild(container);

                setTimeout(function() {
                    if(container.parentNode) container.parentNode.removeChild(container);
                }, delayDivisao + tempoQuedaFilho + 500);
            }

            setInterval(criarEventoCosmico, 2500);
            window.onload = function() { setTimeout(criarEventoCosmico, 500); };
        </script>
    </body>
</html>